<div></div>
  
<script type="text/javascript">
  var logo_white_url = "{{ 'logo.svg' | asset_url }}"
  // var logo_black_url = "{{ 'logo_black.svg' | asset_url }}"
  var chevron_white = "{{ 'chevron-down.svg' | asset_url }}"
  // var chevron_black = "{{ 'chevron-down-black.svg' | asset_url }}"
  $(document).ready(function() {
    // window.addEventListener('scroll', setStickyHeader)
    $(document.body).on('touchmove', setStickyHeader)
    $(document.body).on('scroll', setStickyHeader)
    $(window).on('scroll', setStickyHeader) 
    function setStickyHeader() {
      if (window.innerWidth >= 576) {
        var header_main_height = $('#header_main').height()
        var header_top_height = $('#header_main').find('.top').height()
        if (window.pageYOffset >= header_top_height) {
          $('#header_sticky').css({display: 'flex'})
          if (window.pageYOffset >= header_top_height) {
            $('#header_sticky').css({background: 'rgba(0, 0, 0, 0.32)', backdropFilter: 'blur(32px)'})
            // $('#header_sticky').find('.logo img').attr('src', logo_black_url)
            $('#header_sticky').find('.menu__item').addClass('menu__item-sticky')
            // $('.menu__item-chevron-down').attr('src', chevron_black)
            // $('#header_sticky').find('.menu__item').css({color: '#000000'})
            // $('#header_sticky').find('.menu__item a').css({color: '#000000'})
            // $('#header_sticky').find('.menu__item-button').css({color: '#FFFFFF'})
            // $('#header_sticky').find('.menu__item-button a').css({color: '#FFFFFF'})
            /*$('.menu__item-button').on('mouseover', function() {
              $(this).css({color: '#000000'})
              $(this).find('a').css({color: '#000000'})
            })
            $('.menu__item-button').on('mouseleave', function() {
              $(this).css({color: '#FFFFFF'})
              $(this).find('a').css({color: '#FFFFFF'})
            })*/
          }
          else {
            $('#header_sticky').css({background: 'transparent', backdropFilter: 'unset'})
            $('#header_sticky').find('.logo img').attr('src', logo_white_url)
            $('#header_sticky').find('.menu__item').removeClass('menu__item-sticky')
            $('.menu__item-chevron-down').attr('src', chevron_white)
            // $('#header_sticky').find('.menu__item').css({color: '#FFFFFF'})
            // $('#header_sticky').find('.menu__item a').css({color: '#FFFFFF'})
          }
        }
        else {      
          $('#header_sticky').css({display: 'none'})
        }
      }
      else {
        if ($('body').scrollTop() >= window.innerHeight) {
          $('.top-wrap').addClass('top-wrap-scrolled')
        }
        else {
          $('.top-wrap').removeClass('top-wrap-scrolled')
        }
      }
    }

    function animateLogo () {
      const logoPosition = $('.screenmate-logo').offset()
      $('.screenmate-loader-logo')
        .css('position', 'absolute')
        .animate({
          top: logoPosition.top,
          left: logoPosition.left
        }, 1000)
      setTimeout(() => $('.screenmate-loader').fadeOut(), 1000)
    }

    let video

    setVideo()
    $(window).on('resize', setVideo)

    function setVideo() {
      video = window.innerWidth >= 576 ? $('.screenmate-video video')[0] : $('.screenmate-video video')[1]
    }

    $(video).on('loadedmetadata canplay canplaythrough loadeddata', function() {
      clearInterval(checkInterval)
      setTimeout(() => {
        animateLogo()
        video.play()
      }, 1000)
    })

    checkInterval = setInterval(checkVideoReady, 100)

    function checkVideoReady() {
      if (video.readyState >= 3) {
        clearInterval(checkInterval)
        console.log('Video loaded and ready to play')
        setTimeout(() => {
          animateLogo()
          video.play()
        }, 1000)
      }
    }

    const animateStart = 21
    const animateEnd = 27

    let animate = false

    $(video).on('timeupdate', function() {
        if (!animate && this.currentTime >= animateStart && this.currentTime < animateEnd) {
          animate = true
          $('.screenmate-steamdeck').fadeIn(250)
        } else if (animate && this.currentTime >= animateEnd) {
          animate = false
          $('.screenmate-steamdeck').fadeOut(250)
        }
    })

    $('.screenmate-info-link, .menu__item-subscribe, .banner-button-subscribe').on('click', function () {
      $('.button-close').click()
      $('.screenmate-shadow').css('display', 'flex')
    })

    $('.screenmate-form-close, .screenmate-success-close, .screenmate-error-close').on('click', function () {
      $(this).parents('.screenmate-shadow').css('display', 'none')
    })

    $('.screenmate-form-field-input').on('keydown', function () {      
      $(this).css('border-color', '#D9D9D9')
      $(this).parent('.screenmate-form-field').find('.screenmate-form-field-error').hide()
    })

    $('#check-agree').on('change', function () {
      $(this).parent('div').css('border', 'none')
    })

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    const sendMailUrl = 'https://api.teslogic.co/mail/screenmate-subscribe'

    $('.screenmate-form-button').on('click', async function () {
      const name = $('.screenmate-form-name').val()
      const email = $('.screenmate-form-email').val()
      const isAgree = $('#check-agree').prop('checked')

      if (!isAgree) {
        $('#check-agree').parent('div').css('border', '1px solid #FC3E30')
        return
      }

      if (!name) {
        $('.screenmate-form-name').css('border-color', '#FC3E30')
        return
      }

      if (!emailRegex.test(email)) {
        $('.screenmate-form-email').css('border-color', '#FC3E30')
        return
      }

      const response = await fetch(sendMailUrl, {
          method: 'post',
          body: JSON.stringify({ name, email }),
          headers: {'Content-Type': 'application/json'}
      })
      const data = await response.json()
      
      console.log(data)
      if (response.status == 200) {
        if (data.success) {
          // $('.screenmate-form').css('display', 'none')
          // $('.screenmate-success').css('display', 'flex')
          window.location.href = '/screenmate-done'
        } else {
          if (data.message == 'email_exists') {
            $('#screenmate-email').css('border-color', '#FC3E30')
            $('#screenmate-email').parent('.screenmate-form-field')
                                  .find('.screenmate-form-field-error')
                                  .text('This email is already registered')
                                  .show()
          }
        }
      }
    })

    $('.button-menu').on('click', function() {
      $('.burger-menu-wrap').css('display', 'flex')
      $('.button-close').show()
      $(this).hide()
      $(this).parents('.top').removeClass('top-menu-closed').addClass('top-menu-opened')
      $(this).parents('.top').find('.logo-white').hide()
      $(this).parents('.top').find('.logo-black').show()
      $(this).parents('#header_mobile').find('.banner').removeClass('banner-menu-closed').addClass('banner-menu-opened')
    })
    $('.button-close').on('click', function() {
      $('.burger-menu-wrap').hide()
      $('.button-menu').show()
      $(this).hide()
      $(this).parents('.top').removeClass('top-menu-opened').addClass('top-menu-closed')
      $(this).parents('.top').find('.logo-black').hide()
      $(this).parents('.top').find('.logo-white').show()
      $(this).parents('#header_mobile').find('.banner').removeClass('banner-menu-opened').addClass('banner-menu-closed')
    })

    $(document).on('click', 'a[href^="#"]', function (e) {
      /*$('.burger-menu-wrap').hide()
      $('.button-close').hide()
      if ($(this).attr('href') == '#') {
        e.preventDefault()
      }*/
      if ($(this).attr('href') != '#') {
        e.preventDefault()
        $('.burger-menu-wrap').hide()
        $('.button-close').hide()
        $('html, body').animate({
            scrollTop: $($(this).attr('href')).offset().top
        }, 500)
      }
    })
    if (window.innerWidth >= 575) {
      $('.menu__item').on('mouseover', function() {
        let dropdown = $(this).find('.menu__item-dropdown')
        let chevron_down = $(this).find('.menu__item-chevron-down')
        let chevron_up = $(this).find('.menu__item-chevron-up')
          $('.menu__item-dropdown').each(function() {
            $(this).css('display', 'none')
            $(this).parent('.menu__item').removeClass('menu__item-opened')
          })
          $(dropdown).css('display', 'flex')
          $(chevron_down).hide()
          $(chevron_up).show()
          $(this).addClass('menu__item-opened')
      })
      $('.menu__item').on('mouseleave', function() {
        let dropdown = $(this).find('.menu__item-dropdown')
        let chevron_down = $(this).find('.menu__item-chevron-down')
        let chevron_up = $(this).find('.menu__item-chevron-up')
          $(dropdown).css('display', 'none')
          $(chevron_down).show()
          $(chevron_up).hide()
          $(this).removeClass('menu__item-opened')
      })
    }
    else {
      $('.menu__item').on('click', function() {
        let dropdown = $(this).find('.menu__item-dropdown')
        let chevron_down = $(this).find('.menu__item-chevron-down')
        let chevron_up = $(this).find('.menu__item-chevron-up')
        if ($(dropdown).is(':visible')) {
          $(dropdown).css('display', 'none')
          $(chevron_down).show()
          $(chevron_up).hide()
          $(this).removeClass('menu__item-opened')
        }
        else {
          $('.menu__item-dropdown').each(function() {
            $(this).css('display', 'none')
            $(this).parent('.menu__item').removeClass('menu__item-opened')
          })
          $(dropdown).css('display', 'flex')
          $(chevron_down).hide()
          $(chevron_up).show()
          $(this).addClass('menu__item-opened')
        }      
      })
    }
    $(document).click(function(event) { 
      var $target = $(event.target)
      if (!$target.closest('.menu__item-opened').length) {
        $('.menu__item-dropdown').each(function() {
          $(this).css('display', 'none')
          let chevron_down = $(this).find('.menu__item-chevron-down')
          let chevron_up = $(this).find('.menu__item-chevron-up')
          $(chevron_down).show()
          $(chevron_up).hide()
          $(this).parent('.menu__item').removeClass('menu__item-opened')
        })
      }        
    })
  })  
</script>
