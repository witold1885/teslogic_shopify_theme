<script type="text/javascript">
$(document).ready(async function() {
	const API_ENDPOINT = 'https://www.googleapis.com/youtube/v3/'
	const API_KEY = 'AIzaSyBIO_rLOupamMWN0yNCUUNREWNCFi_3zpc'
	{% assign videos = blogs['bloggers-about-teslogic'].articles | sort: "title" %}
	console.log('videos:')
	console.log({{ videos | json }})
	let videos = {{ videos | json }}
	const videoUrls = [
		'https://www.youtube.com/watch?v=fvmXjgCjxR0&ab_channel=LudicrousFeed',
		'https://www.youtube.com/watch?v=zRVyK_d3k48&t=2s&ab_channel=MikeSeussTesla',
		'https://www.youtube.com/watch?v=ugdLMiZlqNc&ab_channel=Gjeebs',
		'https://www.youtube.com/watch?v=eSLjxnThupg&ab_channel=CfTesla',
		'https://www.youtube.com/watch?v=m06bKl98Pws&ab_channel=BestInTESLA',
		'https://www.youtube.com/watch?v=PrWRb2_jfCE&ab_channel=i1Tesla',
	]

	for (let video of videos) {
		const videoId = getVideoId(video.body_html)
		console.log(videoId)
		if (videoId) {
			let videoInfo = await getVideoInfo(videoId)
			console.log(videoInfo)
			let channelId = videoInfo.items[0].snippet.channelId
			let channelInfo = await getChannelInfo(channelId)
			console.log(channelInfo)
			addVideoItem(videoInfo.items[0].snippet, channelInfo.items[0].snippet, video.summary_html)
		}
	}

	function getVideoId(videoUrl) {
	    let match = videoUrl.match(/[?&]v=([a-zA-Z0-9_-]+)/)
	    if (match) {
	        return match[1]
	    }
	    return null
	}

	async function getVideoInfo(videoId) {
		let response = await fetch(`${API_ENDPOINT}videos?key=${API_KEY}&id=${videoId}&part=snippet`)
		let data = await response.json()
		return data
	}

	async function getChannelInfo(channelId) {
		let response = await fetch(`${API_ENDPOINT}channels?key=${API_KEY}&id=${channelId}&part=snippet`)
		let data = await response.json()
		return data
	}

	function addVideoItem(videoData, channelData, excerpt) {
		let videoItem = `
			<div class="bloggers_block__list-item">
				<div class="bloggers_block__list-item-thumbnail" style="background-image: url('${videoData.thumbnails.high.url}')">
				</div>
				<div class="bloggers_block__list-item-channel">
					<div class="bloggers_block__list-item-channel-thumbnail">
						<img src="${channelData.thumbnails.default.url}">
					</div>
					<div class="bloggers_block__list-item-channel-info">
						<span class="bloggers_block__list-item-channel-title">${channelData.title}: </span>
						<span class="bloggers_block__list-item-channel-excerpt">“${excerpt}”</span>
					</div>
				</div>
			</div>
		`
		$('.bloggers_block__list-scroller').append(videoItem)
	}
})
</script>

<style type="text/css">
.bloggers_block__title {
	color: #0F0F0F;
	font-family: Gotham;
	font-size: 52px;
	font-style: normal;
	font-weight: 700;
	line-height: 64px; /* 123.077% */
	margin-bottom: 40px;
}
.bloggers_block__list {
	display: flex;
	grid-column-gap: 48px;
	margin-left: 80px;
	margin-right: 80px;
	scrollbar-color: transparent transparent;
	cursor: grab;
	user-select: none;
	width: 100vw;
	margin-left: calc(-1 * (100vw - 1366px) / 2);
	overflow-x: visible;
}
.bloggers_block__list-scroller {
	overflow-x: scroll;
	display: flex;
	grid-column-gap: 48px;
	padding-left: calc((100vw - 1366px + 160px) / 2);
	scrollbar-color: transparent transparent;
}
.bloggers_block__list-item {
	display: flex;
	flex-direction: column;
	grid-row-gap: 12px;
	width: 400px;
	padding: 24px 20px 16px;
	border-radius: 20px;
	background: #F4F6FA; 
}
.bloggers_block__list-item-thumbnail {
	width: 360px;
	height: 202px; 
	border-radius: 13px; 
	overflow: hidden;
    background-size: cover;
    background-position: center;
}
.bloggers_block__list-item-channel {
	display: flex;
	grid-column-gap: 8px;
}
.bloggers_block__list-item-channel-thumbnail {
	width: 56px;
	height: 56px;
	border-radius: 88px; 
	overflow: hidden;
}
.bloggers_block__list-item-channel-thumbnail img {
	width: 100%;
	height: 100%;
}
.bloggers_block__list-item-channel-info {
	max-width: 296px;
}
.bloggers_block__list-item-channel-title {
	color: #000;
	font-family: Gotham;
	font-size: 14px;
	font-style: normal;
	font-weight: 400;
	line-height: normal; 
}
.bloggers_block__list-item-channel-excerpt {
	color: #000;
	font-family: Gotham;
	font-size: 16px;
	font-style: normal;
	font-weight: 700;
	line-height: normal; 
}
</style>

<div class="bloggers_block">
  	<div class="block_title bloggers_block__title">Bloggers about Teslogic</div>
	<div class="bloggers_block__list">
		<div class="bloggers_block__list-scroller"></div>		
	</div>
</div>
